# לוח שנה עברי-לועזי

## הפרומפט ההתחלתי
```
אני רוצה לוח שנה עברי לועזי שיציג את התאריך העברי והלועזי בכל יום, ויאפשר לעבור בין חודשים.
צריך להיות אפשרות להציג את הלוח בעברית או באנגלית.
```

## תיאור הפרויקט
לוח שנה עברי-לועזי אינטראקטיבי המציג את התאריכים העבריים והלועזיים במקביל. הלוח נבנה באמצעות JavaScript טהור ומשתמש בספריית Hebcal לחישובי תאריכים עבריים.

## תכונות עיקריות
1. **תצוגה דו-לשונית**
   - תצוגת תאריכים בעברית ובלועזית
   - אפשרות להחלפה בין תצוגה עברית-לועזית ללועזית-עברית
   - כפתור החלפת תצוגה מתעדכן בהתאם למצב הנוכחי:
     * במצב עברי-לועזי: מציג "לועזי עברי"
     * במצב לועזי-עברי: מציג "עברי לועזי"
   - הצגת שמות חודשים לצד התאריכים המשניים:
     * במצב עברי-לועזי: תאריך לועזי עם שם החודש המקוצר (למשל: "15 ינו'")
     * במצב לועזי-עברי: תאריך עברי עם שם החודש המלא (למשל: "ט"ו שבט")

2. **ניווט בלוח**
   - תצוגה נפרדת של שנה וחודש
   - ניווט נוח בין חודשים ושנים:
     * כפתורי ניווט נפרדים לשנה ולחודש
     * חצים בגודל מותאם שמשתנה יחסית לגודל הפונט
   - מעבר בין חודשים עבריים
   - טיפול מיוחד בחודש אדר בשנים מעוברות (אדר א' ואדר ב')
   - מעבר אוטומטי בין שנים

3. **הגדרות מותאמות אישית**
   - בחירת גודל טקסט (קטן, בינוני, גדול)
   - בחירת צבע נושא (כחול, ירוק, כתום)
   - אפשרות להצגת/הסתרת אירועים
   - שמירת ההגדרות ב-localStorage

4. **ממשק משתמש**
   - עיצוב מודרני ונקי
   - תמיכה מלאה בעברית (RTL)
   - חלונות מודאליים לפרטי יום והגדרות
   - הודעות Toast לעדכוני מערכת

## טכנולוגיות
- HTML5
- CSS3 (כולל CSS Variables)
- JavaScript (ES6+)
- [Hebcal](https://github.com/hebcal/hebcal-js) - ספריית חישובי לוח שנה עברי

## מבנה הקוד
- **`index.html`**: מבנה הדף הראשי
- **`styles.css`**: עיצוב ותצוגה
- **`app.js`**: לוגיקת היישום
  - ניהול תאריכים ולוח שנה
  - ניווט בין חודשים
  - ניהול הגדרות
  - אירועי משתמש

## תכונות מיוחדות
1. **טיפול בחודש אדר**
   - תצוגה נכונה של אדר א' ואדר ב' בשנים מעוברות
   - תצוגה של אדר רגיל בשנים רגילות
   - ניווט נכון בין החודשים בשנים מעוברות

2. **שמירת הגדרות**
   - שמירה אוטומטית של העדפות המשתמש
   - טעינת הגדרות בעת פתיחת היישום
   - החלה מיידית של שינויי הגדרות

3. **תמיכה במכשירים ניידים**
   - עיצוב רספונסיבי
   - ממשק מותאם למסכי מגע

## התקנה והפעלה
1. התקן את תלויות הפרויקט:
```bash
npm install @hebcal/core
```

2. פתח את `index.html` בדפדפן

## עדכונים אחרונים

### שיפור סדר חודשים ותצוגת לוח שנה
- שינוי סדר החודשים העבריים כך שתשרי יהיה ראשון בתצוגה
- שמירה על סדר חודשים מניסן בלוגיקה הפנימית (לפי hebcal)
- טיפול נכון בשנים מעוברות ובחודש אדר
- עדכון אוטומטי של השנה העברית הנוכחית בעת ניווט

### שיפורים בממשק המשתמש
- תמיכה בהקשת Enter בחלון הזנת שנה
- הוספת הודעות שגיאה ברורות בהזנת שנה לא תקינה
- שיפור חווית המשתמש בניווט בין שנים

### שיפור הגדרות הצגת אירועים
- הוספת מנגנון מתקדם לבקרת הצגת אירועים
- עדכון מיידי של תצוגת אירועים בהגדרות
- טיפול בטעויות בהמרת תאריכים בעת עדכון הגדרות
- הוספת בדיקות תקינות למניעת שגיאות בעת עדכון הגדרות

### יתרונות
- ממשק משתמש גמיש ואינטואיטיבי
- תיקון אוטומטי של קלט לא תקין
- הודעות שגיאה ברורות

### שיפורים בעיצוב ובחווית המשתמש
- שיפור הבחנה ויזואלית בין ימי החודש הנוכחי לימים מחודשים סמוכים
  * רקע אפור כהה לימים מחוץ לחודש הנוכחי
  * שמירה על צבע טקסט אפור לימים אלו
- מירכוז מדויק של התאריך הראשי בכל תא
  * שימוש ב-flexbox למירכוז
  * מיקום אבסולוטי עם transform
  * הגדלת גודל הטקסט של התאריך הראשי

### עדכונים אחרונים

#### שיפורים בתצוגת לוח השנה
- תיקון מיקום נקודת האירוע לפינה הימנית התחתונה של התא
- מניעת כפילויות גרשיים בתאריכים עבריים (כגון ט"ו, ט"ז)
- הוספת בדיקות תקינות למניעת שגיאות בעיבוד תאריכים
- אתחול אוטומטי של תאריך הבחירה עם התאריך הנוכחי

#### שיפורי טיפול בשגיאות
- הוספת בדיקות null לפני גישה לתכונות תאריך
- טיפול בכל סוגי האירועים (אובייקטים ומחרוזות)
- תצוגה משופרת של אירועים בחלון המודאלי

#### שיפורים בקלט שנה וחודש
- הוספת תמיכה בהזנת שנים עבריות עם אותיות
- יישום המרה מדויקת של אותיות עבריות למספרים
- תמיכה בהזנת שנים מלאות (4 ספרות)

#### שיפורים בבחירת יום ופרטי יום
- הוספת אפשרות לבחירת יום בלוח השנה עם סימון ויזואלי
- שיפור עיצוב התאריך המשני בתא שנבחר
- שדרוג חלון פרטי יום:
  * תצוגה משופרת של תאריך עברי ולועזי
  * הצגת אירועים ומועדים מיוחדים
  * הצגת זמני זריחה ושקיעה
  * אנימציות חלקות בפתיחה וסגירה
  * סגירת חלון בלחיצה על X או מחוץ לחלון

### שיפורים בהצגת אירועים
- שדרוג מנגנון הצגת האירועים לתמיכה מלאה בעברית
- שימוש בפונקציית `render` המשופרת להצגת אירועים
- הגדרת ברירת מחדל לשפה העברית בכל האירועים
- תמיכה בהצגת זמני הדלקת נרות בעברית

### משימות להמשך
- [ ] השלמת פונקציונליות מלאה של שינוי חודש
- [ ] טיפול במעברים בין שנים בעת בחירת חודש
- [ ] אופטימיזציה של קוד הבחירה והניווט

### הערות לפיתוח
- יש להמשיך ולשפר את הטיפול בבחירת חודשים
- לוודא תמיכה מלאה בשנים מעוברות ובחודשים העבריים

## שינויים אחרונים

### 03.02.2025
- שיפור ניהול זמנים ביום
  * תיקון באג ב-`filterTimesBySettings()`
  * הוספת תמיכה מלאה בהצגת זמנים לימים שונים
- שיפור ביצועי הלוח
  * טיוב קוד ניהול אירועים
  * הוספת תמיכה בהצגת אירועים מ-Hebcal

### פברואר 2025
- שיפור ניהול זמנים ביום
  * תיקון באג ב-`filterTimesBySettings()`
  * הוספת תמיכה מלאה בהצגת זמנים לימים שונים
- שיפור ביצועי הלוח
  * טיוב קוד ניהול אירועים
  * הוספת תמיכה בהצגת אירועים מ-Hebcal

## פיתוח עתידי
- הוספת תמיכה באירועים ומועדים יהודיים
- הוספת זמני כניסת ויציאת שבת
- אפשרות ליצוא והדפסת לוח שנה
- סנכרון עם יומן Google
- תמיכה במיקומים שונים לחישוב זמנים

## תכונות מתקדמות בהזנת שנה

### הזנת שנה עברית
- תמיכה בהזנת שנים עבריות בפורמטים שונים:
  * עם גרשיים: "תשפ"ה"
  * ללא גרשיים: "תשפה"
  * עם אלפים: "ה' תשפ"ה"
- טווח תקף: בין השנים 5000-6000 בלוח העברי
- המרה אוטומטית של אותיות עבריות למספרים

### הזנת שנה לועזית
- חישוב דינמי של טווח השנים הלועזיות בהתאם לאלף החמישי
- הגבלת הזנה לשנים התואמות את האלף החמישי בלוח העברי
- תמיכה בהזנת שנים מלאות (4 ספרות)

### יתרונות
- ממשק משתמש גמיש ואינטואיטיבי
- תיקון אוטומטי של קלט לא תקין
- הודעות שגיאה ברורות

## עדכונים אחרונים - פברואר 2025

#### שיפורים בתצוגת זמני היום
- הוספת חלון מודאלי משופר להצגת זמני היום
- תצוגה מאורגנת של זמנים לפי קטגוריות:
  * זמני בוקר (עלות השחר, זמן טלית ותפילין, הנץ החמה)
  * זמני קריאת שמע ותפילה (סוף זמן ק"ש וסוף זמן תפילה)
  * זמני צהריים ומנחה (חצות, מנחה גדולה, מנחה קטנה, פלג המנחה)
  * זמני ערב (שקיעה, צאת הכוכבים)
- עיצוב חדש ונקי:
  * כותרת ראשית אחת "זמני היום"
  * חלוקה ויזואלית ברורה בין קבוצות זמנים
  * קו כחול מודגש בצד ימין של כל קבוצת זמנים
  * מרווחים מותאמים לקריאות מיטבית

#### הוספת הגדרות זמנים מותאמות אישית
- הוספת כותרת "זמני היום" במסך ההגדרות
- הוספת אפשרויות התאמה אישית לזמנים:
  * **עלות השחר**: בחירה בין 72 או 90 דקות לפני הנץ
  * **צאת הכוכבים**: בחירה בין 14, 22.5, או 24 דקות אחרי שקיעה
  * **מוצאי שבת**: אפשרות לבחירה בין זמן רגיל לזמן חזו"א
- שמירת העדפות המשתמש לזמנים ב-localStorage
- עדכון אוטומטי של הזמנים המוצגים בחלון פרטי היום בהתאם להגדרות

#### שיפורים בתצוגת אירועים
- תיקון הצגת אירועים בעברית
- שימוש במתודת `render` המשופרת להצגת אירועים בפורמט עברי
- טיפול בכל סוגי האירועים (אובייקטים ומחרוזות)
- תצוגה משופרת של אירועים בחלון המודאלי

#### שיפורי עיצוב
- עיצוב מודרני ונקי לחלון הזמנים
- שימוש בצבעים ומרווחים עקביים
- תמיכה מלאה בתצוגה מותאמת למובייל
- שיפור הקריאות והנגישות של המידע המוצג

### שיפורים במודאלים
- הוספת גלילה אוטומטית לראש המודאל בכל פתיחה
- שיפור חוויית המשתמש בחלונות מודאליים של פרטי יום והגדרות
- סגירת מודאל ההגדרות בלחיצה מחוץ לתחום

## ייצוא PDF
המערכת משתמשת ב-pdfmake לייצוא קבצי PDF עם תמיכה מלאה בעברית. הספרייה נבחרה בגלל:
- תמיכה טובה בעברית ו-RTL
- יכולת לייצר טבלאות מורכבות
- API פשוט וברור
- תמיכה בגופנים מותאמים אישית

### הגדרת הגופנים
המערכת משתמשת בגופן David Libre שהומר לפורמט base64 ונטען דרך Virtual File System של pdfmake. הקבצים הרלוונטיים:
- `vfs_fonts.js` - מכיל את הגופנים בפורמט base64
- `pdf-export.js` - מכיל את הלוגיקה של ייצוא ה-PDF

### תלויות (Dependencies)
```html
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<script src="vfs_fonts.js"></script>
```

### דוגמה לשימוש
```javascript
const docDefinition = {
    defaultStyle: {
        font: 'DavidLibre',
        fontSize: 10,
        alignment: 'right'
    },
    content: [
        { text: 'טקסט בעברית', fontSize: 18, bold: true }
    ]
};

pdfMake.createPdf(docDefinition).download('example.pdf');

```

## יומן שינויים

### 6 בפברואר 2025 - עדכוני PDF ייצוא

### שינויים עיקריים
- הוסתר כפתור ייצוא PDF זמנית עקב בעיות בטיפול בטקסט עברי
- נוסו מספר גישות לטיפול בטקסט עברי ב-PDF:
  * ניסיון להחליף גרשיים
  * ניסיון לשנות סדר מילים עם "דק'"
  * הסרת תווים מיוחדים מהטקסט

### סטטוס נוכחי
- ייצוא PDF מושהה
- נדרשת בדיקה נוספת של טיפול בטקסט עברי

### המלצות להמשך
- בחינת ספריות נוספות לטיפול בטקסט עברי ב-PDF
- בדיקת תאימות עם פונטים עבריים

## עדכונים אחרונים - 07.02.2025

### שיפורי עיצוב ונושא
1. **שיפור מערכת צבעי נושא**
   - הוספת תמיכה בצבעים משניים לכל נושא (primary, secondary, accent, background)
   - עדכון כל האלמנטים בממשק להשתמש בצבעי הנושא:
     * כותרות השנה והחודש
     * חיצי ניווט קדימה/אחורה
     * היום הנוכחי והיום הנבחר
     * נקודת סימון אירועים
     * כפתורי "ייצוא ל-Excel" ו"שמור הגדרות"

2. **שיפורי UX**
   - עדכון סגנון hover לכפתורים עם אנימציות חלקות
   - הוספת אפשרות לסגירת מודאל הייצוא בלחיצה מחוץ למודאל
   - שיפור עיצוב כפתור "שמור הגדרות" עם גודל טקסט מוגדל וסגנון מודגש

### שיפורי קוד
1. **ניקוי קוד**
   - הסרת console.log מיותרים
   - ארגון מחדש של הקוד הקשור למודאל הייצוא

### שיפורים טכניים
1. **Material Design**
   - אימוץ עקרונות Material Design בבחירת צבעים ואנימציות
   - שימוש בצבעים משניים לאפקט hover
   - הוספת אפקטים כמו צל ותזוזה בעת hover

### שיפורים עתידיים מתוכננים
1. המשך שיפור חווית המשתמש
2. הוספת תמיכה בנושאים נוספים
3. שיפור נגישות הממשק
